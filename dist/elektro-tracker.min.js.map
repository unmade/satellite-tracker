{"version":3,"sources":["module.js","utils.constants.js","utils.coordinate-converter.js","utils.date-converter.js","utils.loaders.js","celestial-object.js","celestial-object.uniforms.js","moon-position.js","player.js","satellite.js","sun.js"],"names":["TRACKER","namespace","ns","i","parts","split","parent","slice","length","utils","Constants","AU","DIFF_EPOCH","GRAD_IN_RAD","JULIAN_C","MJD2000","OMEGA","Math","PI","PI2","SEC_IN_DAY","SEC_IN_RAD","TT_TAI_DIFF","R0","CoordinateConverter","eclipSpherToEquCart","tdb","l","b","r","eps","getEpsMean","THREE","Vector3","cos","sin","tan","eclipticToEquatorial","x","y","z","ts","Const","ts2","ts3","getGMST","date","satellite","gstimeFromDate","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","sphericalToCartesian","DateConverter","utcToMjd","nyear","nmonth","nday","nhours","nminutes","nseconds","a","parseInt","m","jdn","jd","utcToTdb","tt","utcToTT","d","g","mjd","deltaT","getDeltaT","leap_second","Loaders","defferedOBJLoader","obj","name","url","defer","$","Deferred","loader","OBJLoader","load","event","resolve","defferedOBJMTLLoader","objUrl","mtlUrl","mtlLoader","MTLLoader","preload","objLoader","setMaterials","object","promise","defferedTextureLoader","TextureLoader","CelestialObject","userConf","diffuse","diffuseNight","diffuseSpecular","uniforms","this","atmosphere","Kr","Km","ESun","innerRadius","innerSegments","outerRadius","outerSegments","wavelength","scaleDepth","extend","configureUniforms","ground","Mesh","SphereGeometry","ShaderMaterial","vertexShader","fragmentShader","sky","side","BackSide","transparent","prototype","val","arguments","fKrESun","calcfKrESun","fKmESun","calcfKmESun","material","value","val2","g2","fKm4PI","calcfKm4PI","fKr4PI","calcfKr4PI","lightPosition","position","v3LightPosition","copy","normalize","rotateY","angle","cosA","sinA","rotation","m3RotY","set","setTextures","textures","tDiffuse","tDiffuseNight","tDiffuseSpecular","overScale","calcfScaleOverScaleDepth","fScaleDepth","fScaleOverScaleDepth","waveBlue","blue","calcvWaveChannel","v3InvWavelength","setZ","waveGreen","green","setY","waveRed","red","setX","pow","type","Matrix3","fCameraHeight","fCameraHeight2","fInnerRadius","fInnerRadius2","fOuterRadius","fOuterRadius2","fScale","fNightScale","fSpecularScale","fSpecularSize","MoonPosition","frac","f","CoordConverter","getEclipticPosition","dt","fam","fal","fap","fad","faf","dl","ds","dh","dn","v","dr","getEquatorialPosition","eclPos","equPos","Player","init","conf","config","player","Date","width","document","onDateChangeCallback","toggleCoordinatesCallback","changeCameraViewCallback","snapshotCallback","updateScale","range","updateDateRange","updateHover","click","togglePlay","rewind","forward","toNow","toggleSpeed","toggleCoordinates","showCameraViewPopup","mousedown","onDateClicked","mousemove","onDateChange","mouseenter","showPrehover","mouseleave","hidePrehover","onDateClickedAndMove","mouseup","dateClicked","hideCameraViewPopup","e","clicked","setUTCMonth","play","container","is","target","has","hide","startDate","scale","pageX","css","left","right","text","popup","cameraView","offset","outerWidth","toggle","show","toggleClass","coordinateSystem","speed","getFullYear","getMonth","getTime","endDate","Satellite","tle","object3d","satrec","twoline2satrec","line1","line2","setObj","gmst","p","propagate","divideScalar","axis","applyAxisAngle","Sun","lensFlareUpdateCallback","flare","fl","lensFlares","vecX","positionScreen","vecY","distance","degToRad","color","flareColor","Color","setHSL","h","s","light","DirectionalLight","lensFlare","LensFlare","AdditiveBlending","add","customUpdateCallback","sunEclipticPosition","u3","lambda","betta"],"mappings":"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","file":"elektro-tracker.min.js","sourcesContent":["'use strict';\n\n\nvar TRACKER = TRACKER || {};\n\nTRACKER.namespace = function(ns) {\n    var parts = ns.split('.'),\n        parent = TRACKER,\n        i;\n    if (parts[0] === \"TRACKER\") {\n        parts = parts.slice(1);\n    }\n    for (i = 0; i < parts.length; i += 1) {\n       if (typeof parent[parts[i]] === \"undefined\") {\n           parent[parts[i]] = {};\n       }\n       parent = parent[parts[i]];\n   }\n   return parent;\n};\n","TRACKER.namespace('utils.Constants');\n\nTRACKER.utils.Constants = (function() {\n    'use strict';\n\n    // TODO: поправить названия у GRAD_IN_RAD, SEC_IN_RAD\n    return {\n        AU: 149597870.691,\n        DIFF_EPOCH: 2400000.5,\n        GRAD_IN_RAD: 0.017453292519943295088124656649908317,\n        JULIAN_C: 36525.0,\n        MJD2000: 51544.5,\n        OMEGA: 2*Math.PI / 86164.090530833,\n        PI2: 2*Math.PI,\n        SEC_IN_DAY: 86400.0,\n        SEC_IN_RAD: 4.8481368110953597467454098131995829e-06,\n        TT_TAI_DIFF: 32.184,\n        R0: 6378.1363\n    }\n})();\n","/**\n * @file Coverts date between different formats\n * @author Aleksey Maslakov\n */\n\n\nTRACKER.namespace(\"utils.CoordinateConverter\");\n\n/** @namespace utils/utils.coordinate-converter.js */\nTRACKER.utils.CoordinateConverter = (function() {\n    'use strict';\n\n    var Const = TRACKER.utils.Constants;\n\n    return {\n        /** Converts ecliptic (spherical) coordinates to the equatorial (cartesian) ones */\n        eclipSpherToEquCart: eclipSpherToEquCart,\n\n        /** Converts ecliptic (cartesian) coordinates to the equatorial (cartesian) ones */\n        eclipticToEquatorial: eclipticToEquatorial,\n\n        /** Returns angle between absolute and relative celestial coordinate system */\n        getGMST: getGMST,\n\n        /** Return obliquity of the ecliptic in radians */\n        getEpsMean: getEpsMean,\n\n        /** Coverts spherical coordinate to the cartesian  */\n        sphericalToCartesian: sphericalToCartesian\n    }\n\n    /**\n     * Converts ecliptic (spherical) coordinates to the equatorial (cartesian) ones.\n     * @param {Number} tdb - MJD in TDB scale.\n     * @param {Number} l - Longitude in radians.\n     * @param {Number} b - Latitude in radians.\n     * @param {Number} r - Range in km\n     * @returns {THREE.Vector3} Equatorial cartesian coordinates\n     */\n    function eclipSpherToEquCart(tdb, l, b, r) {\n        var eps = getEpsMean(tdb);\n\n        return new THREE.Vector3(\n            r * Math.cos(b) * Math.cos(l),\n            r * Math.cos(b) * (Math.cos(eps)*Math.sin(l) - Math.sin(eps)*Math.tan(b)),\n            r * Math.cos(b) * (Math.sin(eps)*Math.sin(l) + Math.cos(eps)*Math.tan(b))\n        )\n    }\n\n    /**\n     * Converts ecliptic (cartesian) coordinates to the equatorial (cartesian) ones.\n     * @param {Number} tdb - MJD date in TDB scale.\n     * @param {Number} x - x-coordinate on the tdb moment\n     * @param {Number} y - y-coordinate on the tdb moment\n     * @param {Number} z - z-coordinate on the tdb moment\n     * @returns {THREE.Vector3} Equatorial cartesian coordinates\n     */\n    function eclipticToEquatorial(tdb, x, y, z) {\n        var eps = getEpsMean(tdb);\n\n        return new THREE.Vector3(\n            x,\n            y*Math.cos(eps) - z*Math.sin(eps),\n            y*Math.sin(eps) + z*Math.cos(eps)\n        );\n    }\n\n    /**\n     * Return obliquity of the ecliptic in radians.\n     * @param {Number} tdb - MJD date in TDB scale.\n     * @returns {Number} Obliquity of the ecliptic in radians.\n     */\n    function getEpsMean(tdb) {\n        var ts = (tdb - Const.MJD2000) / Const.JULIAN_C,\n            ts2 = ts*ts,\n            ts3 = ts*ts2;\n\n        return Const.SEC_IN_RAD * (84381.448 - 46.8150*ts - 0.00059*ts2 + 0.001813*ts3);\n    }\n\n    /**\n     * Returns greenwich mean sidereal time (GMST) in radians.\n     * @param {Date} date - Civil UTC date.\n     * @returns {Number} GMST in radians.\n     */\n    function getGMST(date) {\n        return satellite.gstimeFromDate(\n            date.getUTCFullYear(),\n            date.getUTCMonth() + 1, // Note, this function requires months in range 1-12.\n            date.getUTCDate(),\n            date.getUTCHours(),\n            date.getUTCMinutes(),\n            date.getUTCSeconds()\n        );\n    }\n\n    /**\n     * Coverts spherical coordinates to the cartesian.\n     * @param {Number} l - Longitude in radians.\n     * @param {Number} b - Latitude in radians.\n     * @param {Number} r - Range in km.\n     * @returns {THREE.Vector3} Cartesian coordinates.\n     */\n    function sphericalToCartesian(l, b, r) {\n        return new THREE.Vector3(\n            r * Math.cos(b) * Math.cos(l),  // x\n            r * Math.cos(b) * Math.sin(l),  // y\n            r * Math.sin(b)                 // z\n        );\n    }\n\n})();\n","/**\n * @file Coverts date between different formats\n * @author Aleksey Maslakov\n */\n\nTRACKER.namespace('utils.DateConverter');\n\n/** @namespace utils/utils.date-converter.js */\nTRACKER.utils.DateConverter = (function() {\n    'use strict';\n    var Const = TRACKER.utils.Constants;\n\n    return {\n        /** Returns ΔT (difference between UT and TT) */\n        getDeltaT: getDeltaT,\n\n        /** Converts civil UTC date to the modified julian days (MJD) */\n        utcToMjd: utcToMjd,\n\n        /** Converts civil UTC date to the barycentric dynamic time (TDB) */\n        utcToTdb: utcToTdb,\n\n        /** Converts civil UTC date to the terrestrial time (TT) */\n        utcToTT: utcToTT,\n    }\n\n    /**\n     * Converts civil UTC date to the modified julian days (MJD)\n     * @param {Date object} date - Date to be converted.\n     * @return {number} Date in modified julian days in UTC scale.\n     */\n    function utcToMjd(date) {\n        var nyear = date.getUTCFullYear(),\n            nmonth = date.getUTCMonth() + 1,\n            nday = date.getUTCDate(),\n            nhours = date.getUTCHours(),\n            nminutes = date.getUTCMinutes(),\n            nseconds = date.getUTCSeconds();\n\n        var a = parseInt((14 - nmonth) / 12);\n        var y = nyear + 4800 - a;\n        var m = nmonth + 12*a - 3;\n\n        var jdn = nday + parseInt((153*m + 2)/5) + 365*y + parseInt(y/4) - parseInt(y/100) + parseInt(y/400) - 32045;\n\n        var jd = (jdn) + ((nhours-12.0)/24.0) + (nminutes/1440.0) + (nseconds/86400.0);\n\n        return jd - Const.DIFF_EPOCH;\n    }\n\n    /**\n     * Converts civil UTC date to the barycentric dynamic time (TDB)\n     * @param {Date object} date - Date to be converted.\n     * @return {number} Date in modified julian days in TDB scale.\n     */\n    function utcToTdb(date) {\n        var tt = utcToTT(date),\n            d = (tt - Const.MJD2000) / Const.JULIAN_C,\n            g = (Const.GRAD_IN_RAD) * (357.258 * 35999.05 * d);\n\n        return tt + (0.001658 * Math.sin(g + 0.0167*Math.sin(g))) / Const.SEC_IN_DAY;\n    }\n\n    /**\n     * Converts civil UTC date to the terrestrial time (TT)\n     * @param {Date object} date - Date to be converted.\n     * @return {number} Date in modified julian days in TT scale.\n     */\n    function utcToTT(date) {\n        var mjd = utcToMjd(date),\n            deltaT = getDeltaT(date.getUTCFullYear(), date.getUTCMonth() + 1);\n\n        return mjd + (deltaT / Const.SEC_IN_DAY);\n    }\n\n    /** Returns ΔT (Correction (TT-UTC) in second)\n     * @param {number} nyear - Full utc year\n     * @param {number} nmonth - Month (1 - 12)\n     * @return {number} Correction (TT-UTC) in second\n     */\n    function getDeltaT(nyear, nmonth) {\n        var leap_second = 0;\n\n        switch (nyear)\n        {\n            case 1972:\n                leap_second = (0 < nmonth && nmonth < 7) ? 10 : 11;\n                break;\n            case 1973:\n                leap_second = 12;\n                break;\n            case 1974:\n                leap_second = 13;\n                break;\n            case 1975:\n                leap_second = 14;\n                break;\n            case 1976:\n                leap_second = 15;\n                break;\n            case 1977:\n                leap_second = 16;\n                break;\n            case 1978:\n                leap_second = 17;\n                break;\n            case 1979:\n                leap_second = 18;\n                break;\n            case 1980:\n                leap_second = 19;\n                break;\n            case 1981:\n                leap_second = (0 < nmonth && nmonth < 7) ? 19 : 20;\n                break;\n            case 1982:\n                leap_second = (0 < nmonth && nmonth < 7) ? 20 : 21;\n                break;\n            case 1983:\n                leap_second = (0 < nmonth && nmonth < 7) ? 21 : 22;\n                break;\n            case 1984:\n                leap_second = 22;\n                break;\n            case 1985:\n                leap_second = (0 < nmonth && nmonth < 7) ? 22 : 23;\n                break;\n            case 1986:\n            case 1987:\n                leap_second = 23;\n                break;\n            case 1988:\n            case 1989:\n                leap_second = 24;\n                break;\n            case 1990:\n                leap_second = 25;\n                break;\n            case 1991:\n                leap_second = 26;\n                break;\n            case 1992:\n                leap_second = (0 < nmonth && nmonth < 7) ? 26 : 27;\n                break;\n            case 1993:\n                leap_second = (0 < nmonth && nmonth < 7) ? 27 : 28;\n                break;\n            case 1994:\n                leap_second = (0 < nmonth && nmonth < 7) ? 28 : 29;\n                break;\n            case 1995:\n                leap_second = 29;\n                break;\n            case 1996:\n                leap_second = 30;\n                break;\n            case 1997:\n                leap_second = (0 < nmonth && nmonth < 7) ? 30 : 31;\n                break;\n            case 1998:\n                leap_second = 31;\n                break;\n            case 1999:\n            case 2000:\n            case 2001:\n            case 2002:\n            case 2003:\n            case 2004:\n            case 2005:\n                leap_second = 32;\n                break;\n            case 2006:\n            case 2007:\n            case 2008:\n                leap_second = 33;\n                break;\n            case 2009:\n            case 2010:\n            case 2011:\n                leap_second = 34;\n                break;\n            case 2012:\n                leap_second = (0 < nmonth && nmonth < 7) ? 34 : 35;\n                break;\n            case 2013:\n            case 2014:\n                leap_second = 35;\n                break;\n            case 2015:\n                leap_second = (0 < nmonth && nmonth < 7) ? 35 : 36;\n                break;\n            default:\n                leap_second = (nyear > 1972) ? 36 : 10;\n        }\n\n        return leap_second + Const.TT_TAI_DIFF;\n    }\n\n})();\n","TRACKER.namespace('utils.Loaders');\n\nTRACKER.utils.Loaders = (function() {\n    'use strict';\n\n    return {\n        defferedOBJLoader: defferedOBJLoader,\n        defferedOBJMTLLoader: defferedOBJMTLLoader,\n        defferedTextureLoader: defferedTextureLoader\n    }\n\n\n    function defferedOBJLoader(obj, name, url) {\n        var defer = $.Deferred();\n        var loader = new THREE.OBJLoader();\n        loader.load(url, function ( event ) {\n            obj[name] = event;\n            defer.resolve();\n        });\n\n        return defer;\n    }\n\n\n    function defferedMTLLoader(obj, name, url) {\n        var defer = $.Deferred();\n        var loader = new THREE.OBJLoader();\n        loader.load(url, function ( event ) {\n            obj[name] = event;\n            defer.resolve();\n        });\n\n        return defer;\n    }\n\n    function defferedOBJMTLLoader(obj, name, objUrl, mtlUrl) {\n        var defer = $.Deferred();\n        var mtlLoader = new THREE.MTLLoader();\n        mtlLoader.load(mtlUrl, function ( event ) {\n            event.preload();\n\n            var objLoader = new THREE.OBJLoader();\n            objLoader.setMaterials(event);\n            objLoader.load(objUrl, function ( object ) {\n                obj[name] = object;\n                defer.resolve();\n            })\n        });\n\n        return defer.promise();\n    }\n\n\n    function defferedTextureLoader(obj, name, url)\n    {\n        var defer = $.Deferred();\n        var loader = new THREE.TextureLoader();\n        loader.load(url, function ( event ) {\n            obj[name] = event;\n            defer.resolve();\n        });\n\n        return defer;\n    }\n\n})();\n","/**\n * @file Celestial Object constructor\n * @author Aleksey Maslakov\n */\n\n\nTRACKER.namespace('CelestialObject');\n\nTRACKER.CelestialObject = (function() {\n    'use strict';\n\n    /**\n     * Creates a new Celestial Object - basically it's two spheres (ground and atmosphere).\n     * @constructor\n     * @param {Object} userConf - user options.\n     * @param {THREE.Texture} [userConf.diffuse] - Texture to show on the bright side of the sphere.\n     * @param {THREE.Texture} [userConf.diffuseNight] - Texture to show on the dark side of the sphere.\n     * @param {THREE.Texture} [userConf.diffuseSpecular] - Specular texture.\n     * @param {Object} [userConf.atmosphere] - Object with parameters of the atmospheres.\n     * @param {Number} [userConf.atmosphere.Kr=0.0025]\n     * @param {Number} [userConf.atmosphere.Km=0.0010]\n     * @param {Number} [userConf.atmosphere.ESun=20.0]\n     * @param {Number} [userConf.atmosphere.g=-0.950]\n     * @param {Number} [userConf.atmosphere.innerRadius=100.0] - Radius of the object.\n     * @param {Number} [userConf.atmosphere.outerRadius=101.5] - Radius of the object's atmopshere.\n     * @param {Number} [userConf.atmosphere.outerRadius=101.5] - Radius of the object's atmopshere.\n     * @param {number[]} [userConf.atmosphere.wavelength=[0.55, 0.5, 0.475]] - RGB Color of the atmosphere.\n     * @param {number} [userConf.atmosphere.scaleDepth=0.25] - RGB Color of the atmosphere.\n     */\n    function CelestialObject(userConf) {\n        var diffuse,\n            diffuseNight,\n            diffuseSpecular,\n            uniforms;\n\n        /**\n         * Ground\n         * @type THREE.Mesh\n         */\n        this.atmosphere = {\n            Kr: 0.0025,\n            Km: 0.0010,\n            ESun: 20.0,\n            g: -0.950,\n            innerRadius: 100.0,\n            innerSegments: 50,\n            outerRadius: 101.5,\n            outerSegments: 128,\n            wavelength: [0.550, 0.50, 0.475],\n            scaleDepth: 0.25,\n        };\n        if (userConf) {\n            if (userConf.atmosphere) {\n                $.extend(this.atmosphere, userConf.atmosphere);\n            }\n            diffuse = userConf.diffuse;\n            diffuseNight = userConf.diffuseNight;\n            diffuseSpecular = userConf.diffuseSpecular;\n        }\n\n        uniforms = CelestialObject.uniforms.configureUniforms(diffuse, diffuseNight, diffuseSpecular, this.atmosphere);\n\n        this.ground = new THREE.Mesh(\n            new THREE.SphereGeometry(this.atmosphere.innerRadius,\n                                     this.atmosphere.innerSegments,\n                                     this.atmosphere.innerSegments),\n            new THREE.ShaderMaterial({\n                uniforms: uniforms,\n                vertexShader: \"//\\n// Atmospheric scattering vertex shader\\n//\\n// Author: Sean O'Neil\\n//\\n// Copyright (c) 2004 Sean O'Neil\\n//\\n// Ported for use with three.js/WebGL by James Baicoianu\\n\\nuniform mat3 m3RotY;\\nuniform vec3 v3LightPosition;\t\t// The direction vector to the light source\\nuniform vec3 v3InvWavelength;\t// 1 / pow(wavelength, 4) for the red, green, and blue channels\\nuniform float fCameraHeight;\t// The camera's current height\\nuniform float fCameraHeight2;\t// fCameraHeight^2\\nuniform float fOuterRadius;\t\t// The outer (atmosphere) radius\\nuniform float fOuterRadius2;\t// fOuterRadius^2\\nuniform float fInnerRadius;\t\t// The inner (planetary) radius\\nuniform float fInnerRadius2;\t// fInnerRadius^2\\nuniform float fKrESun;\t\t\t// Kr * ESun\\nuniform float fKmESun;\t\t\t// Km * ESun\\nuniform float fKr4PI;\t\t\t// Kr * 4 * PI\\nuniform float fKm4PI;\t\t\t// Km * 4 * PI\\nuniform float fScale;\t\t\t// 1 / (fOuterRadius - fInnerRadius)\\nuniform float fScaleDepth;\t\t// The scale depth (i.e. the altitude at which the atmosphere's average density is found)\\nuniform float fScaleOverScaleDepth;\t// fScale / fScaleDepth\\nuniform sampler2D tDiffuse;\\n\\nvarying vec3 v3Direction;\\nvarying vec3 c0;\\nvarying vec3 c1;\\nvarying vec3 vNormal;\\nvarying vec2 vUv;\\n\\nconst int nSamples = 3;\\nconst float fSamples = 3.0;\\n\\nfloat scale(float fCos)\\n{\\n    float x = 1.0 - fCos;\\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\\n}\\n\\nvoid main(void)\\n{\\n\\n    vec3 corrCameraPosition = m3RotY * cameraPosition;\\n    // Get the ray from the camera to the vertex and its length\\n    // (which is the far point of the ray passing through the atmosphere)\\n\\n    vec3 v3Ray = position - corrCameraPosition;\\n    float fFar = length(v3Ray);\\n    v3Ray /= fFar;\\n\\n    // Calculate the closest intersection of the ray with the outer atmosphere\\n    // (which is the near point of the ray passing through the atmosphere)\\n    float B = 2.0 * dot(corrCameraPosition, v3Ray);\\n    float C = fCameraHeight2 - fOuterRadius2;\\n    float fDet = max(0.0, B*B - 4.0 * C);\\n    float fNear = 0.5 * (-B - sqrt(fDet));\\n\\n    // Calculate the ray's starting position, then calculate its scattering offset\\n    vec3 v3Start = corrCameraPosition + v3Ray * fNear;\\n    fFar -= fNear;\\n    float fDepth = exp((fInnerRadius - fOuterRadius) / fScaleDepth);\\n    float fCameraAngle = dot(-v3Ray, position) / length(position);\\n    float fLightAngle = dot(m3RotY*v3LightPosition, position) / length(position);\\n    float fCameraScale = scale(fCameraAngle);\\n    float fLightScale = scale(fLightAngle);\\n    float fCameraOffset = fDepth*fCameraScale;\\n    float fTemp = (fLightScale + fCameraScale);\\n\\n    // Initialize the scattering loop variables\\n    float fSampleLength = fFar / fSamples;\\n    float fScaledLength = fSampleLength * fScale;\\n    vec3 v3SampleRay = v3Ray * fSampleLength;\\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\\n\\n    // Now loop through the sample rays\\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\\n    vec3 v3Attenuate;\\n    for(int i=0; i<nSamples; i++)\\n    {\\n        float fHeight = length(v3SamplePoint);\\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\\n        float fScatter = fDepth*fTemp - fCameraOffset;\\n        v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI)) / 1.1;\\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\\n        v3SamplePoint += v3SampleRay;\\n    }\\n\\n    // Calculate the attenuation factor for the ground\\n    c0 = v3Attenuate;\\n    c1 = v3FrontColor * (v3InvWavelength * fKrESun + fKmESun);\\n\\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n    vUv = uv;\\n    vNormal = normal;\\n}\",\n                fragmentShader: \"//\\n// Atmospheric scattering fragment shader\\n//\\n// Author: Sean O'Neil\\n//\\n// Copyright (c) 2004 Sean O'Neil\\n//\\n// Ported for use with three.js/WebGL by James Baicoianu\\n\\nuniform mat3 m3RotY;\\nuniform float fNightScale;\\nuniform float fSpecularScale;\\nuniform float fSpecularSize;\\nuniform vec3 v3LightPosition;\\nuniform sampler2D tDiffuse;\\nuniform sampler2D tDiffuseNight;\\nuniform sampler2D tDiffuseSpecular;\\n\\nvarying vec3 c0;\\nvarying vec3 c1;\\nvarying vec3 vNormal;\\nvarying vec2 vUv;\\n\\nvoid main (void)\\n{\\n    vec3 diffuseTex = texture2D( tDiffuse, vUv ).xyz;\\n    vec3 diffuseNightTex = texture2D( tDiffuseNight, vUv ).xyz;\\n    vec3 diffuseSpecularTex = texture2D(tDiffuseSpecular, vUv).xyz;\\n\\n    float specularMix = pow(fSpecularScale * dot(normalize(vNormal), m3RotY*v3LightPosition), fSpecularSize) *\\n                            (diffuseSpecularTex.z * 0.5);\\n\\n    vec3 day = diffuseTex * c0;\\n    vec3 night = fNightScale * diffuseNightTex * diffuseNightTex * diffuseNightTex * (1.0 - c0);\\n    vec3 specular = diffuseSpecularTex * specularMix * c0;\\n\\n    gl_FragColor = vec4(c1, 1.0) + vec4(day + night + specular, 1.0);\\n}\"\n            })\n        );\n\n        /**\n         * Atmosphere\n         * @type THREE.Mesh\n         */\n        this.sky = new THREE.Mesh(\n            new THREE.SphereGeometry(this.atmosphere.outerRadius,\n                                     this.atmosphere.outerSegments,\n                                     this.atmosphere.outerSegments),\n            new THREE.ShaderMaterial({\n                uniforms: uniforms,\n                vertexShader: \"//\\n// Atmospheric scattering vertex shader\\n//\\n// Author: Sean O'Neil\\n//\\n// Copyright (c) 2004 Sean O'Neil\\n//\\n\\nuniform mat3 m3RotY;\\nuniform vec3 v3LightPosition;\t// The direction vector to the light source\\nuniform vec3 v3InvWavelength;\t// 1 / pow(wavelength, 4) for the red, green, and blue channels\\nuniform float fCameraHeight;\t// The camera's current height\\nuniform float fCameraHeight2;\t// fCameraHeight^2\\nuniform float fOuterRadius;\t\t// The outer (atmosphere) radius\\nuniform float fOuterRadius2;\t// fOuterRadius^2\\nuniform float fInnerRadius;\t\t// The inner (planetary) radius\\nuniform float fInnerRadius2;\t// fInnerRadius^2\\nuniform float fKrESun;\t\t\t// Kr * ESun\\nuniform float fKmESun;\t\t\t// Km * ESun\\nuniform float fKr4PI;\t\t\t// Kr * 4 * PI\\nuniform float fKm4PI;\t\t\t// Km * 4 * PI\\nuniform float fScale;\t\t\t// 1 / (fOuterRadius - fInnerRadius)\\nuniform float fScaleDepth;\t\t// The scale depth (i.e. the altitude at which the atmosphere's average density is found)\\nuniform float fScaleOverScaleDepth;\t// fScale / fScaleDepth\\n\\nconst int nSamples = 3;\\nconst float fSamples = 3.0;\\n\\nvarying vec3 v3Direction;\\nvarying vec3 c0;\\nvarying vec3 c1;\\n\\n\\nfloat scale(float fCos)\\n{\\n    float x = 1.0 - fCos;\\n    return fScaleDepth * exp(-0.00287 + x*(0.459 + x*(3.83 + x*(-6.80 + x*5.25))));\\n}\\n\\nvoid main(void)\\n{\\n    vec3 corrCameraPosition = m3RotY * cameraPosition;\\n    // Get the ray from the camera to the vertex and its length\\n    // (which is the far point of the ray passing through the atmosphere)\\n    vec3 v3Ray = position - corrCameraPosition;\\n    float fFar = length(v3Ray);\\n    v3Ray /= fFar;\\n\\n    // Calculate the closest intersection of the ray with the outer atmosphere\\n    // (which is the near point of the ray passing through the atmosphere)\\n    float B = 2.0 * dot(corrCameraPosition, v3Ray);\\n    float C = fCameraHeight2 - fOuterRadius2;\\n    float fDet = max(0.0, B*B - 4.0 * C);\\n    float fNear = 0.5 * (-B - sqrt(fDet));\\n\\n    // Calculate the ray's starting position, then calculate its scattering offset\\n    vec3 v3Start = corrCameraPosition + v3Ray * fNear;\\n    fFar -= fNear;\\n    float fStartAngle = dot(v3Ray, v3Start) / fOuterRadius;\\n    float fStartDepth = exp(-1.0 / fScaleDepth);\\n    float fStartOffset = fStartDepth * scale(fStartAngle);\\n\\n    // Initialize the scattering loop variables\\n    float fSampleLength = fFar / fSamples;\\n    float fScaledLength = fSampleLength * fScale;\\n    vec3 v3SampleRay = v3Ray * fSampleLength;\\n    vec3 v3SamplePoint = v3Start + v3SampleRay * 0.5;\\n\\n    // Now loop through the sample rays\\n    vec3 v3FrontColor = vec3(0.0, 0.0, 0.0);\\n    for(int i=0; i<nSamples; i++)\\n    {\\n        float fHeight = length(v3SamplePoint);\\n        float fDepth = exp(fScaleOverScaleDepth * (fInnerRadius - fHeight));\\n        float fLightAngle = dot(m3RotY*v3LightPosition, v3SamplePoint) / fHeight;\\n        float fCameraAngle = dot(v3Ray, v3SamplePoint) / fHeight;\\n        float fScatter = (fStartOffset + fDepth * (scale(fLightAngle) - scale(fCameraAngle)));\\n        vec3 v3Attenuate = exp(-fScatter * (v3InvWavelength * fKr4PI + fKm4PI));\\n\\n        v3FrontColor += v3Attenuate * (fDepth * fScaledLength);\\n        v3SamplePoint += v3SampleRay;\\n    }\\n\\n    // Finally, scale the Mie and Rayleigh colors and set up the varying variables for the pixel shader\\n    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\\n    c0 = v3FrontColor * (v3InvWavelength * fKrESun);\\n    c1 = v3FrontColor * fKmESun;\\n    v3Direction = corrCameraPosition - position;\\n}\",\n                fragmentShader: \"//\\n// Atmospheric scattering fragment shader\\n//\\n// Author: Sean O'Neil\\n//\\n// Copyright (c) 2004 Sean O'Neil\\n//\\n\\nuniform vec3 v3LightPos;\\nuniform float g;\\nuniform float g2;\\n\\nvarying vec3 v3Direction;\\nvarying vec3 c0;\\nvarying vec3 c1;\\n\\n// Calculates the Mie phase function\\nfloat getMiePhase(float fCos, float fCos2, float g, float g2)\\n{\\n    return 1.5 * ((1.0 - g2) / (2.0 + g2)) * (1.0 + fCos2) / pow(1.0 + g2 - 2.0 * g * fCos, 1.5);\\n}\\n\\n// Calculates the Rayleigh phase function\\nfloat getRayleighPhase(float fCos2)\\n{\\n    return 0.75 + 0.75 * fCos2;\\n}\\n\\nvoid main (void)\\n{\\n    float fCos = dot(v3LightPos, v3Direction) / length(v3Direction);\\n    float fCos2 = fCos * fCos;\\n\\n    vec3 color =\tgetRayleighPhase(fCos2) * c0 +\\n                    getMiePhase(fCos, fCos2, g, g2) * c1;\\n\\n    gl_FragColor = vec4(color, 1.0);\\n    gl_FragColor.a = gl_FragColor.b;\\n}\",\n                side: THREE.BackSide,\n                transparent: true\n            })\n        );\n    };\n\n    /**\n     * Gets or sets the ESun param of the atmosphere\n     * @param {number} [val] - Value to be set\n     * @returns {number} If `val` is not specified return current ESun value.\n     *                  If `val` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.ESun = function(val) {\n        if (!arguments.length) return this.atmosphere.ESun;\n\n        var fKrESun = CelestialObject.uniforms.calcfKrESun(this.atmosphere.Kr, val),\n            fKmESun = CelestialObject.uniforms.calcfKmESun(this.atmosphere.Km, val);\n\n        this.atmosphere.ESun = val;\n        this.ground.material.uniforms.fKrESun.value = fKrESun;\n        this.ground.material.uniforms.fKmESun.value = fKmESun;\n        this.sky.material.uniforms.fKmESun.value = fKmESun;\n        this.sky.material.uniforms.fKrESun.value = fKrESun;\n\n        return this;\n    }\n\n    /**\n     * Gets or sets the `g` param of the atmosphere\n     * @param {number} [val] - Value to be set\n     * @returns {number} If `val` is not specified return current g value.\n     *                   If `val` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.g = function(val) {\n        if (!arguments.length) return this.atmosphere.g;\n\n        var val2 = val * val\n        this.atmosphere.g = val;\n        this.sky.material.uniforms.g.value = val;\n        this.sky.material.uniforms.g2.value = val2;\n        this.ground.material.uniforms.g.value = val;\n        this.ground.material.uniforms.g2.value = val2;\n\n        return this;\n    }\n\n    /**\n     * Gets or sets the `Km` param of the atmosphere\n     * @param {number} [val] - Value to be set\n     * @returns {number} If `val` is not specified return current Km value.\n     *                   If `val` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.Km = function(val) {\n        if (!arguments.length) return this.atmosphere.Km;\n\n        var fKmESun = CelestialObject.uniforms.calcfKmESun(val, this.atmosphere.ESun),\n            fKm4PI = CelestialObject.uniforms.calcfKm4PI(val);\n\n        this.atmosphere.Km = val;\n        this.ground.material.uniforms.fKmESun.value = fKmESun;\n        this.ground.material.uniforms.fKm4PI.value = fKm4PI;\n        this.sky.material.uniforms.fKm4PI.value = fKm4PI;\n        this.sky.material.uniforms.fKmESun.value = fKmESun;\n\n        return this;\n    }\n\n    /**\n     * Gets or sets the `Kr` param of the atmosphere\n     * @param {number} [val] - Value to be set\n     * @returns {number} If `val` is not specified return current Kr value.\n     *                   If `val` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.Kr = function(val) {\n        if (!arguments.length) return this.atmosphere.Kr;\n\n        var fKrESun = CelestialObject.uniforms.calcfKrESun(val, this.atmosphere.ESun),\n            fKr4PI = CelestialObject.uniforms.calcfKr4PI(val);\n\n        this.atmosphere.Kr = val;\n        this.ground.material.uniforms.fKrESun.value = fKrESun;\n        this.ground.material.uniforms.fKr4PI.value = fKr4PI;\n        this.sky.material.uniforms.fKr4PI.value = fKr4PI;\n        this.sky.material.uniforms.fKrESun.value = fKrESun;\n\n        return this;\n    }\n\n    /**\n     * Gets or sets the position of the light\n     * @param {THREE.Vector3} [position] - position to be set\n     * @returns {number} If `position` is not specified return current light position value.\n     *                   If `position` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.lightPosition = function(position) {\n        if (!arguments.length) return this.ground.material.uniforms.v3LightPosition.value;\n\n        this.ground.material.uniforms.v3LightPosition.value.copy(position).normalize();\n        this.sky.material.uniforms.v3LightPosition.value.copy(position).normalize();\n\n        return this;\n    };\n\n    /**\n     * Gets or sets the position of the object\n     * @param {THREE.Vector3} [position] - positions to be set\n     * @returns {number} If `position` is not specified return current light position value.\n     *                   If `position` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.position = function(position) {\n        if (!arguments.length) return this.ground.position;\n\n        this.ground.position.copy(position);\n        this.sky.position.copy(position);\n\n        return this;\n    };\n\n    /**\n     * Rotate object around Y-axis by the specified angle.\n     * @param {number} angle - Angle in radians\n     @ @returns `this`\n     */\n    CelestialObject.prototype.rotateY = function(angle) {\n        var cosA = Math.cos(angle),\n            sinA = Math.sin(angle);\n\n        this.ground.rotation.y = angle;\n        this.ground.material.uniforms.m3RotY.value.set(cosA, 0, -sinA,\n                                                       0,    1, 0,\n                                                       sinA, 0, cosA);\n        this.sky.rotation.y = angle;\n        this.sky.material.uniforms.m3RotY.value.set(cosA, 0, -sinA,\n                                                    0,    1, 0,\n                                                    sinA, 0, cosA);\n\n        return this;\n    };\n\n    /**\n     * Sets new object's textures.\n     * @param {Object} textures - Angle in radians\n     * @param {THREE.Texture} [textures.diffuse] - Texture to show on the bright side of the sphere.\n     * @param {THREE.Texture} [textures.diffuseNight] - Texture to show on the dark side of the sphere.\n     * @param {THREE.Texture} [textures.diffuseSpecular] - Specular texture.\n     @ @returns `this`\n     */\n    CelestialObject.prototype.setTextures = function(textures) {\n        if (textures.diffuse) {\n            this.ground.material.uniforms.tDiffuse.value = textures.diffuse;\n        }\n        if (textures.diffuseNight) {\n            this.ground.material.uniforms.tDiffuseNight.value = textures.diffuseNight;\n        }\n        if (textures.diffuseSpecular) {\n            this.ground.material.uniforms.tDiffuseSpecular.value = textures.diffuseSpecular;\n        }\n\n        return this;\n    };\n\n    /**\n     * Gets or sets the `scaleDepth` param of the atmosphere\n     * @param {number} [val] - Value to be set\n     * @returns {number} If `val` is not specified return current scaleDepth value.\n     *                   If `val` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.scaleDepth = function(val) {\n        if (!arguments.length) return this.atmosphere.scaleDepth;\n\n        var overScale = CelestialObject.uniforms.calcfScaleOverScaleDepth(this.atmosphere.innerRadius,\n                                                                          this.atmosphere.outerRadius,\n                                                                          this.atmosphere.scaleDepth);\n        this.atmosphere.scaleDepth = val;\n        this.ground.material.uniforms.fScaleDepth.value = val;\n        this.ground.material.uniforms.fScaleDepth.value = val;\n        this.sky.material.uniforms.fScaleOverScaleDepth.value = overScale;\n        this.sky.material.uniforms.fScaleOverScaleDepth.value = overScale;\n\n        return this;\n    }\n\n    /**\n     * Gets or sets the blue color of the atmosphere's color.\n     * @param {number} [val] - Value to be set\n     * @returns {number} If `val` is not specified return current value value of the blue color.\n     *                   If `val` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.waveBlue = function(val) {\n        if (!arguments.length) return this.atmosphere.wavelength[2];\n\n        var blue = CelestialObject.uniforms.calcvWaveChannel(val);\n        this.atmosphere.wavelength[2] = val;\n        this.ground.material.uniforms.v3InvWavelength.value.setZ(blue);\n        this.sky.material.uniforms.v3InvWavelength.value.setZ(blue);\n\n        return this;\n    }\n\n    /**\n     * Gets or sets the green color of the atmosphere's color.\n     * @param {number} [val] - Value to be set\n     * @returns {number} If `val` is not specified return current value value of the green color.\n     *                   If `val` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.waveGreen = function(val) {\n        if (!arguments.length) return this.atmosphere.wavelength[1];\n\n        var green = CelestialObject.uniforms.calcvWaveChannel(val);\n        this.atmosphere.wavelength[1] = val;\n        this.ground.material.uniforms.v3InvWavelength.value.setY(green);\n        this.sky.material.uniforms.v3InvWavelength.value.setY(green);\n\n        return this;\n    }\n\n    /**\n     * Gets or sets the red color of the atmosphere's color.\n     * @param {number} [val] - Value to be set\n     * @returns {number} If `val` is not specified return current value value of the red color.\n     *                   If `val` is specified sets the new value and return `this`.\n     */\n    CelestialObject.prototype.waveRed = function(val) {\n        if (!arguments.length) return this.atmosphere.wavelength[0];\n\n        var red = CelestialObject.uniforms.calcvWaveChannel(val);\n        this.atmosphere.wavelength[0] = val;\n        this.ground.material.uniforms.v3InvWavelength.value.setX(red);\n        this.sky.material.uniforms.v3InvWavelength.value.setX(red);\n\n        return this;\n    }\n\n    return CelestialObject;\n\n})();\n","/**\n * @file Celestial Object uniforms\n * @author Aleksey Maslakov\n */\n\nTRACKER.namespace('CelestialObject.uniforms');\n\nTRACKER.CelestialObject.uniforms = (function() {\n    'use strict';\n\n    return {\n        calcfKrESun: calcfKrESun,\n        calcfKmESun: calcfKmESun,\n        calcfKr4PI: calcfKr4PI,\n        calcfKm4PI: calcfKm4PI,\n        calcfScaleOverScaleDepth: calcfScaleOverScaleDepth,\n        calcvWaveChannel: calcvWaveChannel,\n        configureUniforms: configureUniforms\n    }\n\n    function calcfKrESun(Kr, ESun) {\n        return Kr * ESun\n    }\n\n    function calcfKmESun(Km, ESun) {\n        return Km * ESun\n    }\n\n    function calcfKr4PI(Kr) {\n        return Kr * 4 * Math.PI\n    }\n\n    function calcfKm4PI(Km) {\n        return Km * 4 * Math.PI\n    }\n\n    function calcfScaleOverScaleDepth(innerRadius, outerRadius, scaleDepth) {\n        return 1 / (outerRadius - innerRadius) / scaleDepth\n    }\n\n    function calcvWaveChannel(val) {\n        return 1 / Math.pow(val, 4)\n    }\n\n    function configureUniforms(diffuse, diffuseNight, diffuseSpecular, atmosphere) {\n        return {\n            m3RotY: {\n                type: \"m3\",\n                value: new THREE.Matrix3()\n            },\n            v3LightPosition: {\n                type: \"v3\",\n                value: new THREE.Vector3(1e8, 0, 1e8).normalize()\n            },\n            v3InvWavelength: {\n                type: \"v3\",\n                value: new THREE.Vector3(calcvWaveChannel(atmosphere.wavelength[0]),\n                                         calcvWaveChannel(atmosphere.wavelength[1]),\n                                         calcvWaveChannel(atmosphere.wavelength[2]))\n            },\n            fCameraHeight: {\n                type: \"f\",\n                value: 0\n            },\n            fCameraHeight2: {\n                type: \"f\",\n                value: 0\n            },\n            fInnerRadius: {\n                type: \"f\",\n                value: atmosphere.innerRadius\n            },\n            fInnerRadius2: {\n                type: \"f\",\n                value: atmosphere.innerRadius * atmosphere.innerRadius\n            },\n            fOuterRadius: {\n                type: \"f\",\n                value: atmosphere.outerRadius\n            },\n            fOuterRadius2: {\n                type: \"f\",\n                value: atmosphere.outerRadius * atmosphere.outerRadius\n            },\n            fKrESun: {\n                type: \"f\",\n                value: calcfKrESun(atmosphere.Kr, atmosphere.ESun)\n            },\n            fKmESun: {\n                type: \"f\",\n                value: calcfKmESun(atmosphere.Km, atmosphere.ESun)\n            },\n            fKr4PI: {\n                type: \"f\",\n                value: calcfKr4PI(atmosphere.Kr)\n            },\n            fKm4PI: {\n                type: \"f\",\n                value: calcfKm4PI(atmosphere.Km)\n            },\n            fScale: {\n                type: \"f\",\n                value: 1 / (atmosphere.outerRadius - atmosphere.innerRadius)\n            },\n            fScaleDepth: {\n                type: \"f\",\n                value: atmosphere.scaleDepth\n            },\n            fScaleOverScaleDepth: {\n                type: \"f\",\n                value: calcfScaleOverScaleDepth(atmosphere.innerRadius, atmosphere.outerRadius, atmosphere.scaleDepth)\n            },\n            g: {\n                type: \"f\",\n                value: atmosphere.g\n            },\n            g2: {\n                type: \"f\",\n                value: atmosphere.g * atmosphere.g\n            },\n            tDiffuse: {\n                type: \"t\",\n                value: diffuse\n            },\n            tDiffuseNight: {\n                type: \"t\",\n                value: diffuseNight\n            },\n            tDiffuseSpecular: {\n                type: \"t\",\n                value: diffuseSpecular\n            },\n            fNightScale: {\n                type: \"f\",\n                value: 1\n            },\n            fSpecularScale: {\n                type: \"f\",\n                value: 1\n            },\n            fSpecularSize: {\n                type: \"f\",\n                value: 25\n            }\n        };\n    }\n})();\n","/**\n * @file Calculates moon position in different coordinate systems\n * @author Aleksey Maslakov\n */\n\nTRACKER.namespace(\"MoonPosition\");\n\n/**\n * Methods to calculate Moon position\n * @namespace MoonPosition\n */\nTRACKER.MoonPosition = (function() {\n    'use strict';\n\n    var Const = TRACKER.utils.Constants,\n        CoordConverter = TRACKER.utils.CoordinateConverter,\n        DateConverter = TRACKER.utils.DateConverter;\n\n    function frac(f) {\n        return f % 1;\n    }\n\n    return {\n        /**\n         * Returns Moon's ecliptic position in spherical coordinates\n         * @param {Date} date - Civil Date in UTC scale to calculate to\n         * @returns {THREE.Vector3} longitude (rad), latitude (rad) and distance (km) respectively\n         */\n        getEclipticPosition: function(date) {\n            var dt = (DateConverter.utcToMjd(date) - Const.MJD2000) / Const.JULIAN_C;\n            // mean elements of lunar orbit\n            var fam = frac(0.606433 + 1336.855225*dt);       // { mean longitude [rev] }\n            var fal = Const.PI2 * frac(0.374897 + 1325.552410*dt);  // { Moon's mean anomaly radian }\n            var fap = Const.PI2 * frac(0.993133 + 99.997361*dt);  // { Sun's mean anomaly  radian }\n            var fad = Const.PI2 * frac(0.827361 + 1236.853086*dt);  // { Diff. long. Moon-Sun }\n            var faf = Const.PI2 * frac(0.259086+1342.227825*dt);  // { Dist. from ascending node }\n            // { perturbations in longitude and latitude }\n            var dl = +22640*Math.sin(fal) - 4586*Math.sin(fal-2*fad)\n                     +2370*Math.sin(2*fad) + 769*Math.sin(2*fal)\n                     -668*Math.sin(fap) - 412*Math.sin(2*faf)\n                     -212*Math.sin(2*fal-2*fad) - 206*Math.sin(fal+fap-2*fad)\n                     +192*Math.sin(fal+2*fad) - 165*Math.sin(fap-2*fap)\n                     -125*Math.sin(fad) - 110*Math.sin(fal+fap)\n                     +148*Math.sin(fal-fap) - 55*Math.sin(2*faf-2*fad);\n            var ds = faf + Const.SEC_IN_RAD * (dl + 412*Math.sin(2*faf) + 541*Math.sin(fap));\n            var dh = faf - 2*fad;\n            var dn = -526*Math.sin(dh) + 44*Math.sin(fal+dh) - 31*Math.sin(-fal+dh) - 23*Math.sin(fap+dh) +\n                      11*Math.sin(-fap+dh) - 25*Math.sin(-2*fal+faf) + 21*Math.sin(-fal+faf);\n            // { ecliptic longitude and latitude }\n            var v = Const.PI2 * frac(fam+dl/1296.0e3);  // { longitude [rad] }\n            var b = Const.SEC_IN_RAD*(18520.0*Math.sin(ds)+dn); // { latitude  [rad] }\n            // { range with correction for range in arcsec }\n            var dr = +3422.70\n                  +28.233869*Math.cos(2*fad)\n                    +3.08589*Math.cos(fal+2*fad)\n                 +186.539296*Math.cos(fal)\n                  +34.311569*Math.cos(fal-2*fad)\n                   +1.916735*Math.cos(fap-2*fad)\n                   -0.977818*Math.cos(fad)\n                  +10.165933*Math.cos(2*fal)\n                   -0.949147*Math.cos(fal+fap)\n                   +1.443617*Math.cos(fal+fap-2*fad);\n            var r = Const.R0 / (0.999953253 * Const.SEC_IN_RAD*dr);  // { range in km }\n\n            return new THREE.Vector3(v, b, r);\n        },\n\n        /**\n         * Returns Moon's Equatorial position\n         * @param {Date} date - Civil Date in UTC scale to calculate to\n         * @returns {THREE.Vector3} - Moon's equatorial position in the cartesian system.\n         */\n        getEquatorialPosition: function(date) {\n            var tdb = DateConverter.utcToTdb(date),\n                eclPos = this.getEclipticPosition(date),\n                equPos = CoordConverter.eclipSpherToEquCart(tdb, eclPos.x, eclPos.y, eclPos.z);\n\n            return new THREE.Vector3(equPos.x, equPos.z, -equPos.y);\n        }\n    }\n})();\n","TRACKER.namespace('Player');\n\nTRACKER.Player = (function() {\n    'use strict';\n\n    var player = {};\n\n    player.onDateChangeCallback = null;\n    player.changeCameraViewCallback = null;\n    player.clicked = false;\n    player.coordinateSystem = 'geocentric';\n    player.date = null;\n    player.play = true;\n    player.speed = 1000;\n    player.snapshotCallback = null;\n    player.toggleCoordinatesCallback = null;\n    player.width = null;\n\n    player.init = init;\n    player.dateClicked = dateClicked;\n    player.forward = forward;\n    player.hideCameraViewPopup = hideCameraViewPopup;\n    player.hidePrehover = hidePrehover;\n    player.onDateChange = onDateChange;\n    player.onDateClicked = onDateClicked;\n    player.onDateClickedAndMove = onDateClickedAndMove;\n    player.rewind = rewind;\n    player.showCameraViewPopup = showCameraViewPopup;\n    player.showPrehover = showPrehover;\n    player.toggleCoordinates = toggleCoordinates;\n    player.togglePlay = togglePlay;\n    player.toggleSpeed = toggleSpeed;\n    player.toNow = toNow;\n    player.updateDateRange = updateDateRange;\n    player.updateHover = updateHover;\n    player.updateScale = updateScale;\n\n\n    function init(conf) {\n        var config = conf || {};\n\n        player.date = config.date || new Date();\n        player.width = $(document).width();\n        player.onDateChangeCallback = config.onDateChangeCallback || null;\n        player.toggleCoordinatesCallback = config.toggleCoordinatesCallback || null;\n        player.changeCameraViewCallback = config.changeCameraViewCallback || null;\n        player.snapshotCallback = config.snapshotCallback || null;\n\n        player.updateScale(player.range, player.width);\n        player.updateDateRange(player.date);\n        player.updateHover();\n\n        $('#play').click(player.togglePlay);\n        $('#rewind').click(player.rewind);\n        $('#forward').click(player.forward);\n        $('#now').click(player.toNow);\n        $('#speed').click(player.toggleSpeed);\n        $('#coordinate_system').click(player.toggleCoordinates);\n        $('#camera_view').click(player.showCameraViewPopup);\n        $('#camera_view_popup .st-popup-item').click(player.changeCameraViewCallback);\n        $('#snapshot').click(player.snapshotCallback);\n\n        $('.st-progress-bar').mousedown(player.onDateClicked)\n            .mousemove(player.onDateChange)\n            .mouseenter(player.showPrehover)\n            .mouseleave(player.hidePrehover);\n\n        $(document).mousemove(player.onDateClickedAndMove)\n            .mouseup(player.dateClicked)\n            .mouseup(player.hideCameraViewPopup);\n\n        return player;\n    }\n\n    function dateClicked(e) {\n        player.clicked = false;\n    }\n\n    function forward() {\n\t\tplayer.date.setUTCMonth(player.date.getUTCMonth() + 1);\n\t\tplayer.updateDateRange(player.date);\n        if (!player.play && typeof player.onDateChangeCallback === 'function') {\n\t\t\tplayer.onDateChangeCallback();\n\t\t}\n    }\n\n    function hideCameraViewPopup(e) {\n        var container = $(\"#camera_view_popup\");\n\n        if (!container.is(e.target) && container.has(e.target).length === 0) {\n            container.hide();\n        }\n    }\n\n    function hidePrehover() {\n        if (player.clicked) return;\n        $('.st-hover-progress').hide(100);\n        $('.st-selected-date').hide(100);\n    }\n\n    function onDateChange(e) {\n\t\tvar date = new Date(player.startDate + player.scale * e.pageX);\n\t\t$('.st-selected-date').css({\n\t\t\t'left': (player.width/2 >= e.pageX) ? e.pageX : 'auto',\n\t\t\t'right': (player.width/2 < e.pageX) ? player.width - e.pageX : 'auto'\n\t\t}).text(date);\n\n\t\t$('.st-hover-progress').css({\n\t\t\twidth: e.pageX\n\t\t});\n\n\t\tif (!player.clicked) return;\n\n\t\t$('.st-play-progress').css({\n\t\t\twidth: e.pageX\n\t\t});\n\t\tplayer.date = date;\n\t\tif (!player.play && typeof player.onDateChangeCallback === 'function') {\n\t\t\tplayer.onDateChangeCallback();\n\t\t}\n\t}\n\n    function onDateClicked(e) {\n        player.clicked = true;\n        player.onDateChange(e);\n    }\n\n    function onDateClickedAndMove(e) {\n        if (!player.clicked) return;\n        player.onDateChange(e);\n    }\n\n    function rewind() {\n\t\tplayer.date.setUTCMonth(player.date.getUTCMonth() - 1);\n\t\tplayer.updateDateRange(player.date);\n        if (!player.play && typeof player.onDateChangeCallback === 'function') {\n\t\t\tplayer.onDateChangeCallback();\n\t\t}\n\t}\n\n    function showCameraViewPopup() {\n\t\tvar popup = $('#camera_view_popup'),\n\t\t\tcameraView = $('#camera_view'),\n\t\t\tpopupHalfWidth = popup.width() / 2;\n\n\t\t$('.st-popup-arrow').css({\n\t\t\t'left': $(document).width() - cameraView.offset().left + cameraView.outerWidth() / 2 - 5\n\t\t});\n\t\tpopup.toggle(100);\n\t};\n\n    function showPrehover() {\n        $('.st-hover-progress').show(100);\n        $('.st-selected-date').show(100);\n    }\n\n    function togglePlay() {\n        player.play = !player.play;\n        $('#pause_button').toggleClass('hide');\n        $('#play_button').toggleClass('hide');\n    }\n\n    function toggleCoordinates() {\n        $(this).toggleClass('warning');\n        player.coordinateSystem = (player.coordinateSystem === 'heliocentric') ? 'geocentric' : 'heliocentric';\n        if (typeof player.toggleCoordinatesCallback === 'function') {\n            player.toggleCoordinatesCallback();\n        }\n    }\n\n    function toggleSpeed() {\n        $(this).toggleClass('red');\n        player.speed = (player.speed === 1000) ? 3000 : 1000;\n    }\n\n    function toNow() {\n        player.date = new Date();\n        player.updateDateRange(player.date);\n        if (!player.play && typeof player.onDateChangeCallback === 'function') {\n            player.onDateChangeCallback();\n        }\n    }\n\n\tfunction updateDateRange(date) {\n\t\tplayer.startDate = new Date(date.getFullYear(), date.getMonth(), 1).getTime();\n\t\tplayer.endDate = new Date(date.getFullYear(), date.getMonth() + 1, 0).getTime();\n\t\tplayer.range = player.endDate - player.startDate;\n\t\tplayer.updateScale(player.range, player.width);\n\n\t\treturn player;\n\t}\n\n\tfunction updateHover() {\n\t\t$('.st-play-progress').css({\n\t\t\twidth: (player.date.getTime() - player.startDate) / player.scale\n\t\t});\n\t}\n\n    function updateScale(range, width) {\n        player.width = width;\n        player.scale = player.range / player.width;\n    }\n\n    return player;\n\n})();\n","TRACKER.namespace('Satellite');\n\nTRACKER.Satellite = (function() {\n    'use strict';\n\n    var Const = TRACKER.utils.Constants,\n        CoordConverter = TRACKER.utils.CoordinateConverter,\n        Satellite;\n\n    Satellite = function(tle, scale, object3d) {\n        this.object3d = object3d;\n        this.satrec = satellite.twoline2satrec(tle.line1, tle.line2);\n        this.scale = scale;\n    };\n\n    Satellite.prototype.setObj = function(obj) {\n        this.object3d = obj;\n    };\n\n    Satellite.prototype.position = function(date, gmst) {\n        var p = satellite.propagate(\n    \t\tthis.satrec,\n    \t\tdate.getUTCFullYear(),\n    \t\tdate.getUTCMonth() + 1, // Note, this function requires months in range 1-12.\n    \t\tdate.getUTCDate(),\n    \t\tdate.getUTCHours(),\n    \t\tdate.getUTCMinutes(),\n    \t\tdate.getUTCSeconds()\n    \t).position;\n\n        return new THREE.Vector3(p.x, p.z, -p.y).divideScalar(this.scale);\n    };\n\n    Satellite.prototype.propagate = function(date, gmst) {\n        var position = this.position(date, gmst);\n        this.object3d.position.copy(position);\n\n        return position;\n    }\n\n    Satellite.prototype.rotateY = function(angle) {\n        var axis = new THREE.Vector3(0, 1, 0);\n\n        this.object3d.position.applyAxisAngle(axis, angle);\n    }\n\n    return Satellite;\n\n})();\n","TRACKER.namespace('Sun');\n\nTRACKER.Sun = (function() {\n    'use strict';\n\n    var Const = TRACKER.utils.Constants,\n        CoordConverter = TRACKER.utils.CoordinateConverter,\n        DateConverter = TRACKER.utils.DateConverter;\n\n    function frac(f) {\n        return f % 1;\n    }\n\n    var Sun = function(textures, color, scale) {\n        var flareColor = new THREE.Color( 0xffffff );\n\n        if (color) {\n            flareColor.setHSL( color.h, color.s, color.l + 0.5 );\n        }\n        else {\n            flareColor.setHSL( 0.55, 0.9, 0.5 + 0.5 );\n        }\n\n        this.light = new THREE.DirectionalLight( 0xffffff, 1 );\n        this.lensFlare = new THREE.LensFlare( textures[0], 350, 0.0, THREE.AdditiveBlending, flareColor );\n        this.lensFlare.add( textures[1], 512, 0.0, THREE.AdditiveBlending );\n        this.lensFlare.add( textures[2], 60, 0.6, THREE.AdditiveBlending );\n        this.lensFlare.add( textures[2], 70, 0.7, THREE.AdditiveBlending );\n        this.lensFlare.add( textures[2], 120, 0.9, THREE.AdditiveBlending );\n        this.lensFlare.add( textures[2], 70, 1.0, THREE.AdditiveBlending );\n        this.lensFlare.customUpdateCallback = lensFlareUpdateCallback;\n        this.scale = scale || 63.71;\n    };\n\n    function lensFlareUpdateCallback( object ) {\n\t\tvar f, fl = object.lensFlares.length;\n\t\tvar flare;\n\t\tvar vecX = -object.positionScreen.x * 2;\n\t\tvar vecY = -object.positionScreen.y * 2;\n\t\tfor( f = 0; f < fl; f++ ) {\n\t\t\tflare = object.lensFlares[ f ];\n\t\t\tflare.x = object.positionScreen.x + vecX * flare.distance;\n\t\t\tflare.y = object.positionScreen.y + vecY * flare.distance;\n\t\t\tflare.rotation = 0;\n\t\t}\n\t\tobject.lensFlares[ 2 ].y += 0.025;\n\t\tobject.lensFlares[ 3 ].rotation = object.positionScreen.x * 0.5 + THREE.Math.degToRad( 45 );\n\t}\n\n    Sun.prototype.sunEclipticPosition = function(date) {\n        var tdb = DateConverter.utcToTdb(date),\n            ts = (tdb - Const.MJD2000) / Const.JULIAN_C,\n            u3 = Const.PI2 * frac(0.993133 + 99.997361*ts);\n\n        var l = Const.PI2 * frac(0.7859453 + u3/Const.PI2 +\n                        (6893.0*Math.sin(u3) + 72.0*Math.sin(2*u3) + 6191.2 * ts) / 1296.0e3);\n        var b = 0;\n        var r = 1.0001398 + 1.0e-6 *\n                    ((-16707.37 + 42.04*ts) * Math.cos(u3) - 139.57*Math.cos(2*u3) +\n                      30.76*Math.cos(Const.PI2*frac(0.8274+1236.8531*ts)));\n\n        return {\n            lambda: l,\n            betta: b,\n            range: r * Const.AU\n        };\n    }\n\n    Sun.prototype.position = function(date) {\n        var tdb = DateConverter.utcToTdb(date),\n            eclPos = this.sunEclipticPosition(date),\n            equPos = CoordConverter.eclipSpherToEquCart(tdb, eclPos.lambda, eclPos.betta, eclPos.range);\n\n        return new THREE.Vector3(equPos.x, equPos.z, -equPos.y).divideScalar(this.scale);\n    }\n\n    Sun.prototype.propagate = function(date) {\n        var p = this.position(date);\n\n        this.lensFlare.position.copy(p);\n        this.light.position.copy(p);\n\n        return p;\n    }\n\n    Sun.prototype.rotateY = function(angle) {\n        var axis = new THREE.Vector3(0, 1, 0);\n\n        this.lensFlare.position.applyAxisAngle(axis, angle);\n        this.light.position.applyAxisAngle(axis, angle);\n    }\n\n    return Sun;\n\n})();\n"],"sourceRoot":"/source/"}